angular.module("MovnThereUI",["ui.bootstrap","ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","uiGmapgoogle-maps"]).run(["$rootScope","$location","$http","$window","AuthFactory","UserFactory","TypeAheadFactory",function(a,b,c,d,e){"use strict";a.$on("$routeChangeStart",function(){e.isAuthenticated()&&(c.defaults.headers.common.Authorization="Token token="+d.sessionStorage.getItem("movnThereUI.user"))})}]),angular.module("MovnThereUI").config(["uiGmapGoogleMapApiProvider","GglKey",function(a,b){a.configure({key:b,v:"3.17",libraries:"places"})}]),angular.module("MovnThereUI").constant("_",window._).constant("GglKey","AIzaSyDauT5fcf7PjOB7Kp3aM4xua9GBub1Q724").constant("ZipKey","mR7CGwyCmaENF3yKGeaiO33FaCQg7cNt3V6KrEnOO2Bu5aeMpo5ds8TCKJTSWHm0").constant("ServerUrl","https://movn-there-api.herokuapp.com/"),angular.module("MovnThereUI").config(["$routeProvider",function(a){"use strict";a.when("/",{templateUrl:"views/home.html",controller:"HomeCtrl"}).when("/users",{templateUrl:"views/users.html",controller:"UserCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/signup",{templateUrl:"views/signup.html",controller:"SignupCtrl"}).when("/logout",{controller:"LogoutCtrl"}).when("/about",{templateUrl:"views/about.html"}).when("/contact",{templateUrl:"views/contact.html"}).otherwise({redirectTo:"/"})}]),angular.module("MovnThereUI").controller("NavbarController",["$scope","$location","AuthFactory",function(a,b,c){"use strict";a.isActive=function(a){return a===b.path()},a.logout=function(){c.logout().success(function(){b.path("/login")})},a.isLoggedIn=function(){return c.isAuthenticated()}}]),angular.module("MovnThereUI").controller("HomeCtrl",["$scope","uiGmapGoogleMapApi","uiGmapIsReady","TypeAheadFactory","ZipRadiusFactory",function(a,b,c,d,e){"use strict";b.then(function(a){a.visualRefresh=!0}),c.promise().then(function(){a.radiusCities=a.zipSearchRadius(a.zip,a.searchMiles)}),a.latitude=42.3584865,a.longitude=-71.060097,a.city="Boston, MA, USA",a.zip="02201",a.searchMiles=5,a.radiusCities={},a.onSelect=function(b){a.latitude=b.location.lat,a.longitude=b.location.lng,a.city=b.formatted_address,a.zip=a.getZip(a.city),a.cities=a.zipSearchRadius(a.zip,a.searchMiles),a.map.marker.city=a.city,a.map.marker.coords.latitude=a.latitude,a.map.marker.coords.longitude=a.longitude,a.map.control.refresh({latitude:a.latitude,longitude:a.longitude,city:a.city})},a.radiusSearch=function(a,b,c,d){var e,f;e=new google.maps.LatLng(a,b),f={location:e,radius:5e4,types:"(cities)"},c.radarSearch(f,d)},a.radiusSearchCallback=function(a,b){if(b!=google.maps.places.PlacesServiceStatus.OK)return void alert(b);for(var c,d=0;c=a[d];d++)console.log(c[d].geometry.location)},a.getLocation=function(a){return d.getLocation(a).then(function(a){var b=[];return angular.forEach(a.data.results,function(a){b.push({formatted_address:a.formatted_address,location:a.geometry.location})}),b})},a.zipSearchRadius=function(b,c){e.fetchCities(b,c).then(function(b){a.zipCities=b})},a.getZip=function(a){var b,c;return b=a.lastIndexOf(","),c=a.substr(b-5,5)},a.map={center:{latitude:a.latitude,longitude:a.longitude},zoom:12,control:{},events:{tilesloaded:function(b){a.$apply(function(){a.gMap=b})}}},a.map.marker={idKey:1,coords:{latitude:a.latitude,longitude:a.longitude},city:a.city,icon:"styles/images/map-pin-sm.png",showWindow:!1,control:{}},a.map.window={templateUrl:"partials/point-info.html",templateParameter:{city:a.city,lat:a.latitude,lon:a.longitude}},a.windowOptions={visible:!1},a.onClick=function(){a.windowOptions.visible=!a.windowOptions.visible},a.closeClick=function(){a.windowOptions.visible=!1}}]),angular.module("MovnThereUI").controller("LoginCtrl",["$scope","$location","AuthFactory",function(a,b,c){"use strict";a.login=function(a){c.login(a).success(function(){b.path("/")})},a.goToSignup=function(){b.path("/signup")}}]),angular.module("MovnThereUI").controller("SignupCtrl",["$scope","$location","AuthFactory",function(a,b,c){"use strict";a.signup=function(a){c.signup(a).success(function(){b.path("/")})},a.goTologin=function(){b.path("/login")}}]),angular.module("MovnThereUI").controller("LogoutCtrl",["$scope","$location","AuthFactory",function(a,b,c){"use strict";a.logout=function(a){c.login(a).success(function(){b.path("/")})}}]),angular.module("MovnThereUI").controller("UserCtrl",["$scope","UserFactory",function(a,b){"use strict";b.fetch(),a.users=b.users}]),angular.module("MovnThereUI").factory("UserFactory",["$http","ServerUrl",function(a,b){"use strict";var c=[],d=function(){a.get(b+"users.json").success(function(a){angular.copy(a,c)})};return{users:c,fetch:d}}]),angular.module("MovnThereUI").factory("AuthFactory",["$http","$window","ServerUrl",function(a,b,c){"use strict";var d=function(d){return a.post(c+"login",d).success(function(c){b.sessionStorage.setItem("movnThereUI.user",c.token),a.defaults.headers.common.Authorization="Token token="+b.sessionStorage.getItem("movnThereUI.user")})},e=function(d){var e={user:d};return a.post(c+"signup",e).success(function(c){b.sessionStorage.setItem("movnThereUI.user",c.token),a.defaults.headers.common.Authorization="Token token="+b.sessionStorage.getItem("movnThereUI.user")})},f=function(){return a.post(c+"/logout").success(function(){b.sessionStorage.removeItem("movnThereUI.user")})},g=function(){return!!b.sessionStorage.getItem("movnThereUI.user")};return{login:d,signup:e,logout:f,isAuthenticated:g}}]),angular.module("MovnThereUI").factory("TypeAheadFactory",["$http","GglKey",function(a,b){"use strict";return{getLocation:function(c){return a.get("https://maps.googleapis.com/maps/api/geocode/json",{headers:{Accept:"application/json, text/plain, * / *",Authorization:void 0},params:{address:c,key:b,types:"(cities)",components:"country:US",sensor:!1}})}}}]),angular.module("MovnThereUI").factory("ZipRadiusFactory",["$http","$q","ZipKey",function(a,b,c){"use strict";var d={},e={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}};return d.fetchCities=function(b,d){var f=["https://www.zipcodeapi.com/rest/",c,"/radius.json/",b,"/",d,"/mile/"].join("");return a.jsonp(f,e).then(function(a){return{data:a.data}},function(a){throw a.status+" : "+a.data})},d}]),angular.module("MovnThereUI").controller("PointInfoCtrl",["$scope",function(a){a.templateValue="hello from the template itself",a.clickedButtonInWindow=function(){var a="Future: display communities in radius each with place and census data";alert(a)}}]);